# 1������

���ǵ����ǵ��з�������ʲô����ô����Ȼ�з�ģʽ�ٻ���ţ��ڲ�ͬ�ŶӶ����Լ���һ���з����̡�������ʵĲ���䡣һ�������õ����󣬽���������Ϻ�Ϳ�ʼ����������������������������У�����ͼ������һ���ử�ġ���������������������ơ�Ҫ���һ�����飬���һ���߼�������ͼ����õı��ַ�ʽ����������������˽����ľ������в��衣

�������ˣ����Ӧ�ö�������һ�־���������ǰ������ͼ��Ƶ��ж��������ȱ����ʱ���ܻ����������������⣬����ƫ��ԭ����Ƶ����̡����ǣ��������õ����룬�ٶԱȼ����������ᾪ̾�ķ��֣�ʲô������ͼ��������ϵ�����ͼ��ȫ�Բ��ϡ���������ǳ�˵�ģ��ĵ����ɿ���Ҫ���˽�һ��ϸ�ڣ�ֱ�ӿ�����������Ч��ֱ�ӵķ�ʽ�����������ڲ��˽��߼�����������ǰ�����۴����Ƕ�ô��ɬ�Ѷ���ôʹ��ġ�

compileflow���������������̵Ŀ��ӻ�����������̺�д������Ϊһ�塣�㿴�������̣��������еĴ��롣��Ȼ�����Ĵ��ڲ�����������������ӻ������⡣����ֻ�ǵ�һ������������

# 2�����˼·

compileflow��Ҫ�����漸���׶Σ�
![p4](p4.png)
һ��һ�������п�ʼ�ڵ㡢�����ڵ㡢��֧�ڵ㡢����ִ�нڵ�ȵȡ�compileflow�����һ��Э�飬�������ø�Э��༭һ��XML��XML��Ӧһ�����̵�ִ���߼�����Ȼ��������compileflow��ʶ��XML��������һ��java�࣬�ٱ����class�������ڴ����������󻺴���������������Ҫִ��ָ��XML������ʱ����ʵ����ִ���˱������õĶ����ࡣ�ǲ��Ǿ����е���DSL��Ʊ�̡���ΪXML�༭�������Ѻá���������ͬʱ���׿�����һ��Idea�������������������ͼ������һ��ͨ�����ӻ��ķ�ʽ��������ͼ��������ɺ󣬾����Զ�����XML�ļ��ˡ�

# 3������˵��

### 3.1 ����

����ͨ��һ���򵥵İ�������˵������ļ����׶Σ�������Щʲô�����������յ�һ��������Ҫ��дһ���߼�����һ������ƽ������

### 3.2 ������ƣ�

���������󣬰�֮ǰ�����ۣ�������Ҫ���һ���࣬������һ������������ξ���һ������Ȼ����������߼����ǿ��������ƽ������Ȼ�󷵻ز������Ǳ��������ƽ������ֵ��Ȼ������compileflow�������������ģ�

####��1����ƽ׶Σ�����ͼ��ƣ����Ǳ�ѡ��
��������case�����ǿ����ò����������Ȱ�����ͼ�����������£�
![p1](p1.png)
��Ȼ���ǻ���Ҫ˫������ͼ�հ׵ĵط��ͽڵ㴦������α��������á����ﲻ��չ������ϸ����ȥ[���ʲ����ҳ](https://github.com/alibaba/compileflow-idea-designer)�˽⡣

####��2����ƽ׶Σ�����XMLЭ�飩
��������Զ��ѿ��ӻ�������ת��XMLЭ�顣���Ե�һ���ǷǱ�ѡ��������˽�XMLЭ�顣��Ҳ�����ֶ��༭������
![p2](p2.png)
��ʵ���Լ��о������Э�飬���ǱȽϼ򵥵ġ���Ȼ����֧���Ա��ڲ���Э�顣����Ҳ��ȥ֧��ҵ�ڵ�bpmnЭ�顣�������˾����Ա��ڲ���Э����ԱȽϼ��һ�㡣

#### (3) Ԥ����׶Σ�����Java�ļ�������class������java����

��������Ƿ����ڵ�һ��ִ������ʱ������˵��ϵͳ����ʱ������Ԥload�������磬�����ǵ�demo�����У���Spring����ʱ���Ϳ�ʼ����xml��[demo��ַ](https://github.com/xuan698400/compileflow_demo)

```
/**
 * ע�⣺����������ϵͳ����ʱ��Ԥ�ȼ���bpm���̵��ڴ棬��ֹ��һ�ε���ʱ����ʼ�������������ĺ�ʱ
 *
 * @author xuan
 * @since 2020/8/16
 */
@Component
@Configuration
public class BpmInitializer implements InitializingBean {

    @Override
    public void afterPropertiesSet() throws Exception {
        ProcessEngine processEngine = ProcessEngineFactory.getProcessEngine();
        processEngine.load("bpm.ktvExample");
        processEngine.load("bpm.demo");
    }

    @Bean
    public SpringApplicationContextProvider getSpringApplicationContextProvider() {
        return new SpringApplicationContextProvider();
    }

}
```

*
����Java�ļ���compileflow��ȥʶ�����XML��Ȼ���������һ��Java�ࡣ���˵����XMLЭ�鿴��һ�ּ򵥵ı�����ԡ���ôcompileflow������ͳ䵱�˱��������߼�������ԵĴ��ڣ�����Ϊ����������Ը��Ѻõı��롣�����ո߼����Ի��ǻᱻ�������ͼ��Ļ������ԡ������һ��CPU��ʶ��Ķ�����ָ���compileflow�ǰѳ�������̿��ӻ������ȸ߼�������Ը�����������һ��������ͼ�����ò��Ԥ��������java���롣![p3](p3.png)
* ����Java�ļ����ٶ�̬�����class�ļ���
* ������class�ļ������ص��ڴ棬���÷�����������󣬻Ỻ�浽�ڴ�MAP���棬����key����XMLЭ�������code���ԡ�

### ��4�����н׶Σ�ִ��java����

��ִ������ʱ�����ǻ�Ҫ��ָ��XML��code����ʵ���ʱ������Ĳ����Ѿ���ɵĲ���ˡ�
����ΨһҪ���ľ��ǣ��ӻ���MAP�������codeȡ����Ӧ����ִ���õ�������С�

```
public void run2() {
    //code��bpm�ļ��ж���
    String code = "bpm.sqrt";

    //ִ�����̵����
    Map<String, Object> context = new HashMap<>();
    context.put("num", 4);

    try {
        ProcessEngine processEngine = ProcessEngineFactory.getProcessEngine();
        Map<String, Object> result = processEngine.start(code, context);
        System.out.println(result.get("numSqrt"));
    } catch (Exception e) {
        e.printStackTrace();
    }
}
```

# 4���������

����ܺõĽ���˴������̵Ŀ��ӻ����������쳣����ʱ�����ǿ��������Ŀ�����������ͼ����Ȼ��compileflow�����������ڴˡ�����javaһ����JVM���������Լ��ر���class�ļ�������ͨ���������class�ļ����������С���ͬ��compileflow��ʵҲ����֧�����������XMLЭ�顣����洢��DB�����ǿ��Թ���һ���������ģ����������̽���ͳһ���������ǽ�����Ҫ�滻���̵�����һ���ڵ�ʱ������ֻ��Ҫ��������XMLЭ�鵽�������ģ�����������������Э�鵽���л����������Ϳ���ʵ�������߼��Ķ�̬��չ������Ȼǰ���ǽڵ���߼��ɸ��ã��ȵȡ�����ֻ�ǻ���compileflowһ����չ������Ŀǰ���ǻ���Ŭ���������С����磺����WEB�������eclipse��������Լ�֧�ָ����bpmnЭ�飬�����ṩspringboot��starter�ȵȡ��ε���Զ��

# ������

* [compileflow���濪Դ��ַ](https://github.com/alibaba/compileflow)
* [compileflow-idea-designer�������Դ��ַ](https://github.com/alibaba/compileflow-idea-designer)
* [demo������Ŀ��ַ](https://github.com/xuan698400/compileflow_demo)